{"version":3,"sources":["@wordpress/blocks/src/api/parser/fix-custom-classname.js"],"names":["hasBlockSupport","getSaveContent","parseWithAttributeSchema","CLASS_ATTR_SCHEMA","type","source","selector","attribute","getHTMLRootElementClasses","innerHTML","parsed","trim","split","fixCustomClassname","blockAttributes","blockType","className","omittedClassName","attributesSansClassName","serialized","defaultClasses","actualClasses","customClasses","filter","includes","length","join"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,eAAT,QAAgC,iBAAhC;AACA,SAASC,cAAT,QAA+B,eAA/B;AACA,SAASC,wBAAT,QAAyC,wBAAzC;AAEA,MAAMC,iBAAiB,GAAG;AACzBC,EAAAA,IAAI,EAAE,QADmB;AAEzBC,EAAAA,MAAM,EAAE,WAFiB;AAGzBC,EAAAA,QAAQ,EAAE,8BAHe;AAIzBC,EAAAA,SAAS,EAAE;AAJc,CAA1B;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,yBAAT,CAAoCC,SAApC,EAAgD;AACtD,QAAMC,MAAM,GAAGR,wBAAwB,CACrC,+BAA+BO,SAAW,QADL,EAEtCN,iBAFsC,CAAvC;AAKA,SAAOO,MAAM,GAAGA,MAAM,CAACC,IAAP,GAAcC,KAAd,CAAqB,KAArB,CAAH,GAAkC,EAA/C;AACA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,SAASC,kBAAT,CAA6BC,eAA7B,EAA8CC,SAA9C,EAAyDN,SAAzD,EAAqE;AAC3E,MAAKT,eAAe,CAAEe,SAAF,EAAa,iBAAb,EAAgC,IAAhC,CAApB,EAA6D;AAC5D;AACA;AACA;AACA;AACA,UAAM;AAAEC,MAAAA,SAAS,EAAEC,gBAAb;AAA+B,SAAGC;AAAlC,QACLJ,eADD;AAEA,UAAMK,UAAU,GAAGlB,cAAc,CAAEc,SAAF,EAAaG,uBAAb,CAAjC;AACA,UAAME,cAAc,GAAGZ,yBAAyB,CAAEW,UAAF,CAAhD;AACA,UAAME,aAAa,GAAGb,yBAAyB,CAAEC,SAAF,CAA/C;AAEA,UAAMa,aAAa,GAAGD,aAAa,CAACE,MAAd,CACnBP,SAAF,IAAiB,CAAEI,cAAc,CAACI,QAAf,CAAyBR,SAAzB,CADE,CAAtB;;AAIA,QAAKM,aAAa,CAACG,MAAnB,EAA4B;AAC3BX,MAAAA,eAAe,CAACE,SAAhB,GAA4BM,aAAa,CAACI,IAAd,CAAoB,GAApB,CAA5B;AACA,KAFD,MAEO,IAAKP,UAAL,EAAkB;AACxB,aAAOL,eAAe,CAACE,SAAvB;AACA;AACD;;AAED,SAAOF,eAAP;AACA","sourcesContent":["/**\n * Internal dependencies\n */\nimport { hasBlockSupport } from '../registration';\nimport { getSaveContent } from '../serializer';\nimport { parseWithAttributeSchema } from './get-block-attributes';\n\nconst CLASS_ATTR_SCHEMA = {\n\ttype: 'string',\n\tsource: 'attribute',\n\tselector: '[data-custom-class-name] > *',\n\tattribute: 'class',\n};\n\n/**\n * Given an HTML string, returns an array of class names assigned to the root\n * element in the markup.\n *\n * @param {string} innerHTML Markup string from which to extract classes.\n *\n * @return {string[]} Array of class names assigned to the root element.\n */\nexport function getHTMLRootElementClasses( innerHTML ) {\n\tconst parsed = parseWithAttributeSchema(\n\t\t`<div data-custom-class-name>${ innerHTML }</div>`,\n\t\tCLASS_ATTR_SCHEMA\n\t);\n\n\treturn parsed ? parsed.trim().split( /\\s+/ ) : [];\n}\n\n/**\n * Given a parsed set of block attributes, if the block supports custom class\n * names and an unknown class (per the block's serialization behavior) is\n * found, the unknown classes are treated as custom classes. This prevents the\n * block from being considered as invalid.\n *\n * @param {Object} blockAttributes Original block attributes.\n * @param {Object} blockType       Block type settings.\n * @param {string} innerHTML       Original block markup.\n *\n * @return {Object} Filtered block attributes.\n */\nexport function fixCustomClassname( blockAttributes, blockType, innerHTML ) {\n\tif ( hasBlockSupport( blockType, 'customClassName', true ) ) {\n\t\t// To determine difference, serialize block given the known set of\n\t\t// attributes, with the exception of `className`. This will determine\n\t\t// the default set of classes. From there, any difference in innerHTML\n\t\t// can be considered as custom classes.\n\t\tconst { className: omittedClassName, ...attributesSansClassName } =\n\t\t\tblockAttributes;\n\t\tconst serialized = getSaveContent( blockType, attributesSansClassName );\n\t\tconst defaultClasses = getHTMLRootElementClasses( serialized );\n\t\tconst actualClasses = getHTMLRootElementClasses( innerHTML );\n\n\t\tconst customClasses = actualClasses.filter(\n\t\t\t( className ) => ! defaultClasses.includes( className )\n\t\t);\n\n\t\tif ( customClasses.length ) {\n\t\t\tblockAttributes.className = customClasses.join( ' ' );\n\t\t} else if ( serialized ) {\n\t\t\tdelete blockAttributes.className;\n\t\t}\n\t}\n\n\treturn blockAttributes;\n}\n"]}