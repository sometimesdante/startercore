{"version":3,"sources":["@wordpress/blocks/src/api/raw-handling/figure-content-reducer.js"],"names":["isFigureContent","node","schema","tag","nodeName","toLowerCase","figure","children","canHaveAnchor","a","wrapFigureContent","element","beforeElement","ownerDocument","createElement","parentNode","insertBefore","appendChild","figureContentReducer","doc","nodeToInsert","childNodes","length","wrapper","closest","classList","contains","textContent","trim"],"mappings":";;;;;;;AAGA;;AAHA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,eAAT,CAA0BC,IAA1B,EAAgCC,MAAhC,EAAyC;AAAA;;AACxC,QAAMC,GAAG,GAAGF,IAAI,CAACG,QAAL,CAAcC,WAAd,EAAZ,CADwC,CAGxC;AACA;;AACA,MAAKF,GAAG,KAAK,YAAR,IAAwB,wBAAeF,IAAf,CAA7B,EAAqD;AACpD,WAAO,KAAP;AACA;;AAED,SAAOE,GAAG,8BAAMD,MAAN,aAAMA,MAAN,yCAAMA,MAAM,CAAEI,MAAd,mDAAM,eAAgBC,QAAtB,yEAAkC,EAAlC,CAAV;AACA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,aAAT,CAAwBP,IAAxB,EAA8BC,MAA9B,EAAuC;AAAA;;AACtC,QAAMC,GAAG,GAAGF,IAAI,CAACG,QAAL,CAAcC,WAAd,EAAZ;AAEA,SAAOF,GAAG,+BAAMD,MAAN,aAAMA,MAAN,0CAAMA,MAAM,CAAEI,MAAd,6EAAM,gBAAgBC,QAAtB,oFAAM,sBAA0BE,CAAhC,2DAAM,uBAA6BF,QAAnC,2EAA+C,EAA/C,CAAV;AACA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASG,iBAAT,CAA4BC,OAA5B,EAA+D;AAAA,MAA1BC,aAA0B,uEAAVD,OAAU;AAC9D,QAAML,MAAM,GAAGK,OAAO,CAACE,aAAR,CAAsBC,aAAtB,CAAqC,QAArC,CAAf;AACAF,EAAAA,aAAa,CAACG,UAAd,CAAyBC,YAAzB,CAAuCV,MAAvC,EAA+CM,aAA/C;AACAN,EAAAA,MAAM,CAACW,WAAP,CAAoBN,OAApB;AACA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACe,SAASO,oBAAT,CAA+BjB,IAA/B,EAAqCkB,GAArC,EAA0CjB,MAA1C,EAAmD;AACjE,MAAK,CAAEF,eAAe,CAAEC,IAAF,EAAQC,MAAR,CAAtB,EAAyC;AACxC;AACA;;AAED,MAAIkB,YAAY,GAAGnB,IAAnB;AACA,QAAMc,UAAU,GAAGd,IAAI,CAACc,UAAxB,CANiE,CAQjE;AACA;;AACA,MACCP,aAAa,CAAEP,IAAF,EAAQC,MAAR,CAAb,IACAa,UAAU,CAACX,QAAX,KAAwB,GADxB,IAEAW,UAAU,CAACM,UAAX,CAAsBC,MAAtB,KAAiC,CAHlC,EAIE;AACDF,IAAAA,YAAY,GAAGnB,IAAI,CAACc,UAApB;AACA;;AAED,QAAMQ,OAAO,GAAGH,YAAY,CAACI,OAAb,CAAsB,OAAtB,CAAhB,CAlBiE,CAoBjE;AACA;AACA;;AACA,MAAKD,OAAL,EAAe;AACd;AACA;AACA,QAAK,CAAEtB,IAAI,CAACwB,SAAZ,EAAwB;AACvBf,MAAAA,iBAAiB,CAAEU,YAAF,EAAgBG,OAAhB,CAAjB;AACA,KAFD,MAEO,IACNtB,IAAI,CAACwB,SAAL,CAAeC,QAAf,CAAyB,YAAzB,KACAzB,IAAI,CAACwB,SAAL,CAAeC,QAAf,CAAyB,WAAzB,CADA,IAEAzB,IAAI,CAACwB,SAAL,CAAeC,QAAf,CAAyB,aAAzB,CAFA,IAGA,CAAEH,OAAO,CAACI,WAAR,CAAoBC,IAApB,EAJI,EAKL;AACDlB,MAAAA,iBAAiB,CAAEU,YAAF,EAAgBG,OAAhB,CAAjB;AACA;AACD,GAbD,MAaO,IAAKH,YAAY,CAACL,UAAb,CAAwBX,QAAxB,KAAqC,MAA1C,EAAmD;AACzDM,IAAAA,iBAAiB,CAAEU,YAAF,CAAjB;AACA;AACD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isTextContent } from '@wordpress/dom';\n\n/**\n * Whether or not the given node is figure content.\n *\n * @param {Node}   node   The node to check.\n * @param {Object} schema The schema to use.\n *\n * @return {boolean} True if figure content, false if not.\n */\nfunction isFigureContent( node, schema ) {\n\tconst tag = node.nodeName.toLowerCase();\n\n\t// We are looking for tags that can be a child of the figure tag, excluding\n\t// `figcaption` and any phrasing content.\n\tif ( tag === 'figcaption' || isTextContent( node ) ) {\n\t\treturn false;\n\t}\n\n\treturn tag in ( schema?.figure?.children ?? {} );\n}\n\n/**\n * Whether or not the given node can have an anchor.\n *\n * @param {Node}   node   The node to check.\n * @param {Object} schema The schema to use.\n *\n * @return {boolean} True if it can, false if not.\n */\nfunction canHaveAnchor( node, schema ) {\n\tconst tag = node.nodeName.toLowerCase();\n\n\treturn tag in ( schema?.figure?.children?.a?.children ?? {} );\n}\n\n/**\n * Wraps the given element in a figure element.\n *\n * @param {Element} element       The element to wrap.\n * @param {Element} beforeElement The element before which to place the figure.\n */\nfunction wrapFigureContent( element, beforeElement = element ) {\n\tconst figure = element.ownerDocument.createElement( 'figure' );\n\tbeforeElement.parentNode.insertBefore( figure, beforeElement );\n\tfigure.appendChild( element );\n}\n\n/**\n * This filter takes figure content out of paragraphs, wraps it in a figure\n * element, and moves any anchors with it if needed.\n *\n * @param {Node}     node   The node to filter.\n * @param {Document} doc    The document of the node.\n * @param {Object}   schema The schema to use.\n *\n * @return {void}\n */\nexport default function figureContentReducer( node, doc, schema ) {\n\tif ( ! isFigureContent( node, schema ) ) {\n\t\treturn;\n\t}\n\n\tlet nodeToInsert = node;\n\tconst parentNode = node.parentNode;\n\n\t// If the figure content can have an anchor and its parent is an anchor with\n\t// only the figure content, take the anchor out instead of just the content.\n\tif (\n\t\tcanHaveAnchor( node, schema ) &&\n\t\tparentNode.nodeName === 'A' &&\n\t\tparentNode.childNodes.length === 1\n\t) {\n\t\tnodeToInsert = node.parentNode;\n\t}\n\n\tconst wrapper = nodeToInsert.closest( 'p,div' );\n\n\t// If wrapped in a paragraph or div, only extract if it's aligned or if\n\t// there is no text content.\n\t// Otherwise, if directly at the root, wrap in a figure element.\n\tif ( wrapper ) {\n\t\t// In jsdom-jscore, 'node.classList' can be undefined.\n\t\t// In this case, default to extract as it offers a better UI experience on mobile.\n\t\tif ( ! node.classList ) {\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\n\t\t} else if (\n\t\t\tnode.classList.contains( 'alignright' ) ||\n\t\t\tnode.classList.contains( 'alignleft' ) ||\n\t\t\tnode.classList.contains( 'aligncenter' ) ||\n\t\t\t! wrapper.textContent.trim()\n\t\t) {\n\t\t\twrapFigureContent( nodeToInsert, wrapper );\n\t\t}\n\t} else if ( nodeToInsert.parentNode.nodeName === 'BODY' ) {\n\t\twrapFigureContent( nodeToInsert );\n\t}\n}\n"]}